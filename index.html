<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Triangulum OS</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --os-primary: #00a8ff;
    --os-primary-dark: #0097e6;
    --os-bg: #1e1e2e;
    --os-surface: #27293d;
    --os-surface-light: #2d3142;
    --os-text: #e4e4e7;
    --os-text-dim: #a1a1aa;
    --os-border: #3f3f5e;
    --os-accent: #ff6b9d;
    --os-success: #00d9ff;
    --os-warning: #ffc107;
    --os-error: #ff4757;
    --taskbar-height: 48px;
    --window-border-radius: 8px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    word-wrap: break-word;
    overflow-wrap: break-word;
}

body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--os-bg);
    color: var(--os-text);
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

/* Boot/Loading Screen */
.boot-screen {
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 99999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
}

.boot-screen.hidden {
    display: none;
}

.boot-logo-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 40px;
}

.boot-triangle {
    width: 100px;
    height: 100px;
    position: relative;
    animation: simplePulse 2s ease-in-out infinite;
}

.boot-triangle::before {
    content: '';
    position: absolute;
    width: 0;
    height: 0;
    border-left: 50px solid transparent;
    border-right: 50px solid transparent;
    border-bottom: 87px solid var(--os-primary);
    filter: drop-shadow(0 0 20px var(--os-primary));
}

.boot-text {
    font-size: 36px;
    font-weight: 600;
    color: var(--os-primary);
    letter-spacing: 6px;
    animation: simpleFadeIn 1s ease-in;
    text-align: center;
}

@keyframes simplePulse {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.8;
        transform: scale(1.05);
    }
}

@keyframes simpleFadeIn {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}

/* Desktop Background */
.desktop {
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, #1e1e2e 0%, #27293d 50%, #1e1e2e 100%);
    background-image: 
        radial-gradient(circle at 20% 30%, rgba(0, 168, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(255, 107, 157, 0.1) 0%, transparent 50%);
    overflow: hidden;
    padding-bottom: var(--taskbar-height);
}

/* Desktop Icons */
.desktop-icons {
    position: absolute;
    top: 20px;
    left: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    z-index: 1;
}

.desktop-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    padding: 12px;
    border-radius: 8px;
    transition: all 0.2s;
    width: 80px;
    text-align: center;
    user-select: none;
}

.desktop-icon:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.05);
}

.desktop-icon:active {
    transform: scale(0.95);
    background: rgba(0, 168, 255, 0.3);
}

.desktop-icon.active {
    background: rgba(0, 168, 255, 0.2);
}

.desktop-icon i {
    font-size: 32px;
    color: var(--os-primary);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

.desktop-icon span {
    font-size: 12px;
    color: var(--os-text);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    word-wrap: break-word;
    overflow-wrap: break-word;
    max-width: 80px;
    text-align: center;
    white-space: normal;
    line-height: 1.2;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
}

/* Windows */
.window {
    position: absolute;
    background: var(--os-surface);
    border: 1px solid var(--os-border);
    border-radius: var(--window-border-radius);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    display: none;
    flex-direction: column;
    min-width: 400px;
    min-height: 300px;
    max-width: calc(100vw - 20px);
    max-height: calc(100vh - var(--taskbar-height) - 20px);
    overflow: hidden;
    z-index: 100;
}

.window.active {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    z-index: 1000;
}

.window.minimized {
    display: none !important;
    visibility: hidden !important;
}

.window.maximized {
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: calc(100% - var(--taskbar-height)) !important;
    border-radius: 0;
}

/* Window Header */
.window-header {
    background: linear-gradient(180deg, var(--os-surface-light) 0%, var(--os-surface) 100%);
    padding: 8px 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: move;
    border-bottom: 1px solid var(--os-border);
    user-select: none;
}

.window-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 500;
    color: var(--os-text);
    max-width: calc(100% - 150px);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.window-title i {
    color: var(--os-primary);
}

.window-controls {
    display: flex;
    gap: 8px;
    position: relative;
    z-index: 100;
    pointer-events: auto;
}

.window-btn {
    width: 32px;
    height: 32px;
    border: none;
    background: transparent;
    color: var(--os-text-dim);
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    font-size: 14px;
    position: relative;
    z-index: 10;
    pointer-events: auto;
}

.window-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--os-text);
}

.window-btn.close:hover {
    background: var(--os-error);
    color: white;
}

/* Window Content */
.window-content {
    flex: 1;
    padding: 16px;
    overflow: auto;
    background: var(--os-surface);
}

/* Taskbar */
.taskbar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: var(--taskbar-height);
    background: rgba(30, 30, 46, 0.95);
    backdrop-filter: blur(20px);
    border-top: 1px solid var(--os-border);
    display: flex;
    align-items: center;
    padding: 0 8px;
    gap: 4px;
    z-index: 10000;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
}

.taskbar-start {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--os-primary) 0%, var(--os-primary-dark) 100%);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    margin-right: 8px;
}

.taskbar-start:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 168, 255, 0.4);
}

.taskbar-start i {
    font-size: 20px;
    color: white;
}

.taskbar-apps {
    flex: 1;
    display: flex;
    gap: 4px;
    align-items: center;
}

.taskbar-app {
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
    min-width: 120px;
    border: 1px solid transparent;
}

.taskbar-app:hover {
    background: rgba(255, 255, 255, 0.1);
}

.taskbar-app.active {
    background: rgba(0, 168, 255, 0.2);
    border-color: var(--os-primary);
}

.taskbar-app i {
    font-size: 16px;
    color: var(--os-primary);
}

.taskbar-app span {
    font-size: 12px;
    color: var(--os-text);
    max-width: 100px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.taskbar-tray {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 12px;
    border-left: 1px solid var(--os-border);
}

.tray-icon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s;
    color: var(--os-text-dim);
}

.tray-icon:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--os-text);
}

.tray-time {
    padding: 4px 12px;
    font-size: 12px;
    color: var(--os-text);
    font-weight: 500;
}

/* Start Menu */
.start-menu {
    position: fixed;
    bottom: calc(var(--taskbar-height) + 4px);
    left: 8px;
    width: 400px;
    max-height: 600px;
    background: rgba(30, 30, 46, 0.98);
    backdrop-filter: blur(30px);
    border: 1px solid var(--os-border);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    display: none;
    flex-direction: column;
    z-index: 10001;
    overflow: hidden;
}

.start-menu.active {
    display: flex;
}

.start-menu-header {
    background: linear-gradient(135deg, var(--os-primary) 0%, var(--os-primary-dark) 100%);
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
}

.start-menu-header i {
    font-size: 48px;
    color: white;
}

.start-menu-header h2 {
    color: white;
    font-size: 24px;
    font-weight: 600;
}

.start-menu-search {
    padding: 12px;
    border-bottom: 1px solid var(--os-border);
}

.start-menu-search input {
    width: 100%;
    padding: 10px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--os-border);
    border-radius: 8px;
    color: var(--os-text);
    font-size: 14px;
}

.start-menu-search input:focus {
    outline: none;
    border-color: var(--os-primary);
    background: rgba(255, 255, 255, 0.15);
}

.start-menu-apps {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}

.start-menu-app {
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    text-align: center;
}

.start-menu-app:hover {
    background: rgba(0, 168, 255, 0.2);
    border-color: var(--os-primary);
    transform: translateY(-2px);
}

.start-menu-app i {
    font-size: 32px;
    color: var(--os-primary);
}

.start-menu-app span {
    font-size: 12px;
    color: var(--os-text);
}

.start-menu-footer {
    padding: 12px;
    border-top: 1px solid var(--os-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.start-menu-footer button {
    padding: 8px 16px;
    background: rgba(255, 107, 157, 0.2);
    border: 1px solid var(--os-accent);
    border-radius: 6px;
    color: var(--os-accent);
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s;
}

.start-menu-footer button:hover {
    background: var(--os-accent);
    color: white;
}

/* Terminal Window */
.terminal-window {
    font-family: 'Consolas', 'Monaco', monospace;
}

.terminal-content {
    background: #0a0a0a;
    color: #00ff00;
    padding: 16px;
    height: 100%;
    overflow-y: auto;
    font-size: 14px;
    line-height: 1.6;
}

.terminal-line {
    margin-bottom: 4px;
}

.terminal-prompt {
    color: #00ff00;
}

.terminal-input-line {
    display: flex;
    align-items: center;
    gap: 8px;
}

.terminal-input {
    background: transparent;
    border: none;
    color: #00ff00;
    font-family: inherit;
    font-size: inherit;
    flex: 1;
    outline: none;
}

.terminal-cursor {
    display: inline-block;
    width: 8px;
    height: 16px;
    background: #00ff00;
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

/* File Manager */
.file-manager-content {
    display: flex;
    height: 100%;
}

.file-manager-sidebar {
    width: 200px;
    background: var(--os-surface-light);
    border-right: 1px solid var(--os-border);
    padding: 16px;
}

.file-manager-main {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
}

.file-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 16px;
}

.file-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
}

.file-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.file-item i {
    font-size: 48px;
    color: var(--os-primary);
}

.file-item span {
    font-size: 12px;
    text-align: center;
    color: var(--os-text);
    max-width: 100%;
    word-wrap: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
}

/* Browser Window */
.browser-toolbar {
    background: var(--os-surface-light);
    padding: 8px 12px;
    display: flex;
    gap: 8px;
    align-items: center;
    border-bottom: 1px solid var(--os-border);
}

.browser-nav-btn {
    width: 32px;
    height: 32px;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    color: var(--os-text);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.browser-nav-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.browser-url {
    flex: 1;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--os-border);
    border-radius: 6px;
    color: var(--os-text);
    font-size: 13px;
}

.browser-content {
    flex: 1;
    padding: 0;
    overflow-y: auto;
    overflow-x: hidden;
    background: white;
    color: #333;
    position: relative;
}

.browser-content iframe {
    width: 100%;
    height: 100%;
    border: none;
    display: block;
}

.browser-content img {
    max-width: 100%;
    height: auto;
    display: block;
}

.browser-search-results {
    max-width: 800px;
    margin: 0 auto;
}

.search-result-item {
    margin-bottom: 24px;
    padding: 16px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    transition: all 0.2s;
    cursor: pointer;
}

.search-result-item:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border-color: var(--os-primary);
}

.search-result-url {
    color: #006621;
    font-size: 14px;
    margin-bottom: 4px;
}

.search-result-title {
    color: #1a0dab;
    font-size: 20px;
    font-weight: 400;
    margin-bottom: 8px;
    text-decoration: none;
}

.search-result-title:hover {
    text-decoration: underline;
}

.search-result-snippet {
    color: #545454;
    font-size: 14px;
    line-height: 1.6;
}

.browser-home {
    text-align: center;
    padding: 60px 20px;
}

.browser-logo {
    font-size: 72px;
    color: var(--os-primary);
    margin-bottom: 20px;
    text-shadow: 0 0 20px rgba(0, 168, 255, 0.5);
}

.browser-home h1 {
    color: #333;
    margin-bottom: 10px;
}

.browser-home p {
    color: #666;
    margin-bottom: 40px;
}

.search-box-container {
    max-width: 600px;
    margin: 0 auto;
    display: flex;
    gap: 8px;
}

.search-box {
    flex: 1;
    padding: 12px 20px;
    border: 2px solid #ddd;
    border-radius: 24px;
    font-size: 16px;
    outline: none;
}

.search-box:focus {
    border-color: var(--os-primary);
}

.search-btn {
    padding: 12px 24px;
    background: var(--os-primary);
    color: white;
    border: none;
    border-radius: 24px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s;
}

.search-btn:hover {
    background: var(--os-primary-dark);
}

/* Settings Window */
.settings-content {
    display: flex;
    height: 100%;
}

.settings-sidebar {
    width: 200px;
    background: var(--os-surface-light);
    border-right: 1px solid var(--os-border);
    padding: 16px;
}

.settings-category {
    padding: 12px;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 4px;
    transition: all 0.2s;
    color: var(--os-text-dim);
}

.settings-category:hover,
.settings-category.active {
    background: rgba(0, 168, 255, 0.2);
    color: var(--os-primary);
}

.settings-main {
    flex: 1;
    padding: 24px;
    overflow-y: auto;
}

.settings-section {
    margin-bottom: 32px;
}

.settings-section h3 {
    margin-bottom: 16px;
    color: var(--os-primary);
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    margin-bottom: 8px;
}

.setting-item label {
    color: var(--os-text);
}

.toggle-switch {
    width: 48px;
    height: 24px;
    background: var(--os-border);
    border-radius: 12px;
    position: relative;
    cursor: pointer;
    transition: all 0.3s;
}

.toggle-switch.active {
    background: var(--os-primary);
}

.toggle-switch::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    top: 2px;
    left: 2px;
    transition: all 0.3s;
}

.toggle-switch.active::after {
    left: 26px;
}

/* Notifications */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--os-surface);
    border: 1px solid var(--os-border);
    border-radius: 8px;
    padding: 16px;
    min-width: 300px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    display: none;
    z-index: 10002;
    animation: slideIn 0.3s ease;
}

.notification.active {
    display: block;
}

@keyframes slideIn {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.notification-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.notification-title {
    font-weight: 600;
    color: var(--os-primary);
}

.notification-close {
    background: none;
    border: none;
    color: var(--os-text-dim);
    cursor: pointer;
    font-size: 18px;
}

.notification-body {
    color: var(--os-text);
    font-size: 14px;
}

/* Mobile Menu */
.mobile-menu {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 20000;
    flex-direction: column;
    padding: 20px;
    overflow-y: auto;
}

.mobile-menu.active {
    display: flex;
}

.mobile-menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--os-primary);
}

.mobile-menu-logo {
    font-size: 32px;
    font-weight: bold;
    color: var(--os-primary);
}

.mobile-menu-close {
    width: 40px;
    height: 40px;
    background: var(--os-surface);
    border: none;
    border-radius: 8px;
    color: var(--os-text);
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mobile-menu-apps {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
}

.mobile-menu-app {
    background: var(--os-surface);
    border: 1px solid var(--os-border);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
}

.mobile-menu-app:active {
    transform: scale(0.95);
    background: var(--os-primary);
}

.mobile-menu-app i {
    font-size: 48px;
    color: var(--os-primary);
}

.mobile-menu-app.active i {
    color: white;
}

.mobile-menu-app span {
    font-size: 14px;
    color: var(--os-text);
    font-weight: 500;
}

.mobile-menu-app.active span {
    color: white;
}

/* Quick Actions */
.quick-actions {
    display: none;
    position: fixed;
    bottom: calc(var(--taskbar-height) + 10px);
    right: 10px;
    z-index: 1000;
    flex-direction: column;
    gap: 10px;
}

.quick-action-btn {
    width: 56px;
    height: 56px;
    background: var(--os-primary);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 168, 255, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.quick-action-btn:active {
    transform: scale(0.9);
}

.quick-action-btn:hover {
    background: var(--os-primary-dark);
    box-shadow: 0 6px 16px rgba(0, 168, 255, 0.6);
}

/* Responsive Design */
@media (max-width: 1024px) {
    .window {
        min-width: 90%;
    }
    
    .start-menu {
        width: calc(100% - 16px);
        max-width: 500px;
    }
}

@media (max-width: 768px) {
    :root {
        --taskbar-height: 56px;
    }
    
    .boot-logo {
        font-size: 48px;
    }
    
    .boot-text {
        font-size: 18px;
    }
    
    .boot-progress {
        width: 90%;
        max-width: 300px;
    }
    
    .desktop-icons {
        display: none;
    }
    
    .window {
        min-width: 100%;
        min-height: calc(100vh - var(--taskbar-height));
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: calc(100vh - var(--taskbar-height)) !important;
        border-radius: 0;
    }
    
    .window.maximized {
        height: calc(100vh - var(--taskbar-height)) !important;
    }
    
    .window-header {
        padding: 12px;
        font-size: 14px;
    }
    
    .window-btn {
        width: 36px;
        height: 36px;
        font-size: 16px;
    }
    
    .taskbar {
        height: var(--taskbar-height);
        padding: 0 4px;
    }
    
    .taskbar-start {
        width: 56px;
        height: 56px;
        margin-right: 4px;
    }
    
    .taskbar-app {
        min-width: 80px;
        padding: 6px 12px;
        font-size: 11px;
    }
    
    .taskbar-app span {
        display: none;
    }
    
    .taskbar-tray {
        padding: 0 8px;
    }
    
    .tray-time {
        font-size: 11px;
        padding: 4px 8px;
    }
    
    .start-menu {
        width: calc(100% - 16px);
        max-height: calc(100vh - var(--taskbar-height) - 20px);
        bottom: calc(var(--taskbar-height) + 8px);
    }
    
    .start-menu-apps {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .start-menu-app {
        padding: 10px;
    }
    
    .start-menu-app i {
        font-size: 24px;
    }
    
    .start-menu-app span {
        font-size: 10px;
    }
    
    .quick-actions {
        display: flex;
    }
    
    .file-manager-content {
        flex-direction: column;
    }
    
    .file-manager-sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--os-border);
        max-height: 150px;
        overflow-y: auto;
    }
    
    .file-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 12px;
    }
    
    .settings-content {
        flex-direction: column;
    }
    
    .settings-sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--os-border);
        max-height: 200px;
        overflow-y: auto;
        display: flex;
        flex-direction: row;
        overflow-x: auto;
        padding: 12px;
    }
    
    .settings-category {
        min-width: 120px;
        margin-right: 8px;
        margin-bottom: 0;
        text-align: center;
    }
    
    .browser-toolbar {
        flex-wrap: wrap;
        padding: 8px;
    }
    
    .browser-nav-btn {
        width: 40px;
        height: 40px;
    }
    
    .browser-url {
        width: 100%;
        margin: 8px 0;
        order: 3;
    }
    
    .calculator {
        gap: 6px;
        padding: 12px;
    }
    
    .calc-display {
        font-size: 24px;
        padding: 16px;
        min-height: 50px;
    }
    
    .calc-btn {
        padding: 16px;
        font-size: 16px;
    }
    
    .editor-toolbar {
        flex-wrap: wrap;
        gap: 4px;
    }
    
    .editor-btn {
        padding: 6px 10px;
        font-size: 11px;
    }
    
    .terminal-content {
        font-size: 12px;
        padding: 12px;
    }
    
    .desktop-icon {
        width: 70px;
        padding: 10px;
    }
    
    .desktop-icon i {
        font-size: 28px;
    }
    
    .desktop-icon span {
        font-size: 11px;
    }
}

@media (max-width: 480px) {
    .boot-logo {
        font-size: 36px;
    }
    
    .boot-text {
        font-size: 14px;
        letter-spacing: 2px;
    }
    
    .start-menu-apps {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .taskbar-app {
        min-width: 56px;
        padding: 8px;
    }
    
    .file-grid {
        grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    }
    
    .calculator {
        gap: 4px;
        padding: 8px;
    }
    
    .calc-btn {
        padding: 12px;
        font-size: 14px;
    }
    
    .browser-home {
        padding: 40px 16px;
    }
    
    .browser-logo {
        font-size: 48px;
    }
    
    .search-box-container {
        flex-direction: column;
    }
    
    .search-box {
        width: 100%;
        margin-bottom: 8px;
    }
    
    .search-btn {
        width: 100%;
    }
}

/* Touch Optimizations */
@media (hover: none) and (pointer: coarse) {
    .window-btn,
    .browser-nav-btn,
    .editor-btn,
    .calc-btn {
        min-width: 44px;
        min-height: 44px;
    }
    
    .desktop-icon {
        min-width: 60px;
        min-height: 60px;
    }
    
    .file-item {
        min-width: 80px;
        min-height: 80px;
    }
    
    .start-menu-app {
        min-height: 100px;
    }
}

/* Landscape Mobile */
@media (max-width: 768px) and (orientation: landscape) {
    .taskbar {
        height: 48px;
    }
    
    .taskbar-start {
        width: 48px;
        height: 48px;
    }
    
    .window {
        height: calc(100vh - 48px) !important;
    }
    
    .start-menu {
        max-height: calc(100vh - 48px - 20px);
    }
}

/* Calculator */
.calculator {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    padding: 16px;
    background: var(--os-surface-light);
    border-radius: 8px;
}

.calc-display {
    grid-column: 1 / -1;
    background: #000;
    color: #00ff00;
    padding: 20px;
    text-align: right;
    font-size: 32px;
    font-family: 'Consolas', monospace;
    border-radius: 4px;
    min-height: 60px;
    margin-bottom: 8px;
}

.calc-btn {
    padding: 20px;
    background: var(--os-surface);
    border: 1px solid var(--os-border);
    border-radius: 4px;
    color: var(--os-text);
    font-size: 18px;
    cursor: pointer;
    transition: all 0.2s;
}

.calc-btn:hover {
    background: var(--os-primary);
    color: white;
}

.calc-btn.operator {
    background: var(--os-primary);
    color: white;
}

.calc-btn.operator:hover {
    background: var(--os-primary-dark);
}

.calc-btn.equals {
    background: var(--os-success);
    color: white;
    grid-column: span 2;
}

.calc-btn.clear {
    background: var(--os-error);
    color: white;
}

/* Text Editor */
.editor-toolbar {
    background: var(--os-surface-light);
    padding: 8px;
    border-bottom: 1px solid var(--os-border);
    display: flex;
    gap: 8px;
}

.editor-btn {
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--os-border);
    border-radius: 4px;
    color: var(--os-text);
    cursor: pointer;
    font-size: 12px;
}

.editor-btn:hover {
    background: var(--os-primary);
    color: white;
}

.editor-content {
    width: 100%;
    height: 100%;
    background: #1e1e1e;
    color: #d4d4d4;
    border: none;
    padding: 16px;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 14px;
    resize: none;
    outline: none;
}

/* File Manager Real */
.file-item.selected {
    background: rgba(0, 168, 255, 0.3);
    border: 1px solid var(--os-primary);
}

.file-path {
    padding: 8px 12px;
    background: var(--os-surface-light);
    border-bottom: 1px solid var(--os-border);
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
}

.file-path-item {
    color: var(--os-primary);
    cursor: pointer;
}

.file-path-item:hover {
    text-decoration: underline;
}

/* App Switcher */
.app-switcher {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    z-index: 20001;
    display: none;
    align-items: center;
    justify-content: center;
}

.app-switcher.active {
    display: flex;
}

.app-switcher-content {
    background: var(--os-surface);
    border: 1px solid var(--os-border);
    border-radius: 16px;
    padding: 24px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.app-switcher-content h3 {
    color: var(--os-primary);
    margin-bottom: 16px;
    text-align: center;
}

.app-switcher-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 12px;
    margin-bottom: 16px;
}

.app-switcher-item {
    background: var(--os-surface-light);
    border: 2px solid transparent;
    border-radius: 12px;
    padding: 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.app-switcher-item:hover,
.app-switcher-item.active {
    border-color: var(--os-primary);
    background: rgba(0, 168, 255, 0.1);
    transform: scale(1.05);
}

.app-switcher-item i {
    font-size: 32px;
    color: var(--os-primary);
}

.app-switcher-item span {
    font-size: 12px;
    color: var(--os-text);
}

.app-switcher-hint {
    text-align: center;
    color: var(--os-text-dim);
    font-size: 12px;
    padding-top: 16px;
    border-top: 1px solid var(--os-border);
}

/* Quick Settings */
.quick-settings {
    position: fixed;
    top: 60px;
    right: 10px;
    background: var(--os-surface);
    border: 1px solid var(--os-border);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    width: 300px;
    max-height: 400px;
    z-index: 10003;
    display: none;
    flex-direction: column;
}

.quick-settings.active {
    display: flex;
}

.quick-settings-header {
    padding: 16px;
    border-bottom: 1px solid var(--os-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.quick-settings-header h3 {
    color: var(--os-primary);
    font-size: 16px;
}

.quick-settings-header button {
    background: none;
    border: none;
    color: var(--os-text-dim);
    font-size: 18px;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s;
}

.quick-settings-header button:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--os-text);
}

.quick-settings-content {
    padding: 16px;
    overflow-y: auto;
}

.quick-setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    margin-bottom: 8px;
}

.quick-setting-item label {
    color: var(--os-text);
    font-size: 14px;
}

@media (max-width: 768px) {
    .app-switcher-content {
        max-width: 90%;
        padding: 20px;
    }
    
    .app-switcher-list {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
    }
    
    .quick-settings {
        width: calc(100% - 20px);
        right: 10px;
        left: 10px;
        top: 70px;
    }
}
</style>
</head>
<body>
    <!-- Boot Screen -->
    <div class="boot-screen" id="boot-screen">
        <div class="boot-logo-container">
            <div class="boot-triangle"></div>
            <div class="boot-text">TRIANGULUM</div>
        </div>
    </div>

    <!-- Desktop -->
    <div class="desktop" id="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icons">
            <div class="desktop-icon" onclick="openApp('file-manager')">
                <i class="fas fa-folder"></i>
                <span>Files</span>
            </div>
            <div class="desktop-icon" onclick="openApp('terminal')">
                <i class="fas fa-terminal"></i>
                <span>Terminal</span>
            </div>
            <div class="desktop-icon" onclick="openApp('browser')">
                <i class="fas fa-globe"></i>
                <span>Browser</span>
            </div>
            <div class="desktop-icon" onclick="openApp('settings')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </div>
    </div>

    <!-- Windows -->
    <!-- File Manager -->
    <div class="window" id="window-file-manager" style="top: 100px; left: 100px; width: 800px; height: 600px;">
        <div class="window-header" onmousedown="startDrag(event, 'window-file-manager')">
            <div class="window-title">
                <i class="fas fa-folder"></i>
                <span>File Manager</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('file-manager', event)" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="window-btn" onclick="maximizeWindow('file-manager')" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="window-btn close" onclick="closeWindow('file-manager', event)" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content file-manager-content">
            <div class="file-manager-sidebar">
                <h3 style="margin-bottom: 16px; color: var(--os-primary);">Places</h3>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <div style="padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;" onclick="navigateToFolder('/home/triangulum')">
                        <i class="fas fa-home" style="color: var(--os-primary);"></i>
                        <span>Home</span>
                    </div>
                    <div style="padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;" onclick="navigateToFolder('/home/triangulum/Documents')">
                        <i class="fas fa-folder" style="color: var(--os-primary);"></i>
                        <span>Documents</span>
                    </div>
                    <div style="padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;" onclick="navigateToFolder('/home/triangulum/Downloads')">
                        <i class="fas fa-download" style="color: var(--os-primary);"></i>
                        <span>Downloads</span>
                    </div>
                    <div style="padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;" onclick="navigateToFolder('/home/triangulum/Pictures')">
                        <i class="fas fa-images" style="color: var(--os-primary);"></i>
                        <span>Pictures</span>
                    </div>
                    <div style="padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;" onclick="navigateToFolder('/home/triangulum/Music')">
                        <i class="fas fa-music" style="color: var(--os-primary);"></i>
                        <span>Music</span>
                    </div>
                </div>
            </div>
            <div class="file-manager-main">
                <div class="file-grid">
                    <div class="file-item">
                        <i class="fas fa-file"></i>
                        <span>Document.txt</span>
                    </div>
                    <div class="file-item">
                        <i class="fas fa-image"></i>
                        <span>Photo.jpg</span>
                    </div>
                    <div class="file-item">
                        <i class="fas fa-file-video"></i>
                        <span>Video.mp4</span>
                    </div>
                    <div class="file-item">
                        <i class="fas fa-file-pdf"></i>
                        <span>Report.pdf</span>
                    </div>
                    <div class="file-item">
                        <i class="fas fa-folder"></i>
                        <span>Projects</span>
                    </div>
                    <div class="file-item">
                        <i class="fas fa-folder"></i>
                        <span>Downloads</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Terminal -->
    <div class="window terminal-window" id="window-terminal" style="top: 150px; left: 200px; width: 700px; height: 500px;">
        <div class="window-header" onmousedown="startDrag(event, 'window-terminal')">
            <div class="window-title">
                <i class="fas fa-terminal"></i>
                <span>Terminal</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('terminal')" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="window-btn" onclick="maximizeWindow('terminal')" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="window-btn close" onclick="closeWindow('terminal')" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content terminal-content" id="terminal-content">
            <div class="terminal-line">
                <span class="terminal-prompt">triangulum@os:~$</span> Welcome to Triangulum OS Terminal
            </div>
            <div class="terminal-line">
                <span class="terminal-prompt">triangulum@os:~$</span> Type 'help' for available commands
            </div>
            <div class="terminal-line terminal-input-line">
                <span class="terminal-prompt">triangulum@os:~$</span>
                <input type="text" class="terminal-input" id="terminal-input" autofocus>
                <span class="terminal-cursor"></span>
            </div>
        </div>
    </div>

    <!-- Browser -->
    <div class="window" id="window-browser" style="top: 80px; left: 150px; width: 900px; height: 650px;">
        <div class="window-header" onmousedown="startDrag(event, 'window-browser')">
            <div class="window-title">
                <span style="font-size: 16px; font-weight: bold; color: var(--os-primary);">▲</span>
                <span>TRIANGULUM BROWSER</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('browser')" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="window-btn" onclick="maximizeWindow('browser')" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="window-btn close" onclick="closeWindow('browser')" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content" style="display: flex; flex-direction: column; padding: 0;">
            <div class="browser-toolbar">
                <button class="browser-nav-btn" onclick="showBrowserHome()" title="Home">
                    <span style="font-size: 16px; font-weight: bold; color: var(--os-primary);">▲</span>
                </button>
                <button class="browser-nav-btn" onclick="browserGoBack()" title="Back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="browser-nav-btn" onclick="browserGoForward()" title="Forward">
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="browser-nav-btn" onclick="browserRefresh()" title="Refresh">
                    <i class="fas fa-redo"></i>
                </button>
                <input type="text" class="browser-url" value="" placeholder="Search or enter URL..." id="browser-url" onkeypress="if(event.key==='Enter') browserGo()">
                <button class="browser-nav-btn" onclick="browserGo()" title="Go">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <div class="browser-content" id="browser-content">
                <div class="browser-home" id="browser-home">
                    <div class="browser-logo">▲</div>
                    <h1>TRIANGULUM BROWSER</h1>
                    <p>Search the web or enter a URL</p>
                    <div class="search-box-container">
                        <input type="text" class="search-box" id="browser-search-box" placeholder="Search the web..." onkeypress="if(event.key==='Enter') performWebSearch()">
                        <button class="search-btn" onclick="performWebSearch()">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </div>
                <div class="browser-search-results" id="browser-search-results" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Settings -->
    <div class="window" id="window-settings" style="top: 120px; left: 180px; width: 800px; height: 600px;">
        <div class="window-header" onmousedown="startDrag(event, 'window-settings')">
            <div class="window-title">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('settings')" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="window-btn" onclick="maximizeWindow('settings')" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="window-btn close" onclick="closeWindow('settings')" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content settings-content">
            <div class="settings-sidebar">
                <div class="settings-category active" onclick="switchSettingsCategory('system')">
                    <i class="fas fa-desktop"></i> System
                </div>
                <div class="settings-category" onclick="switchSettingsCategory('display')">
                    <i class="fas fa-display"></i> Display
                </div>
                <div class="settings-category" onclick="switchSettingsCategory('network')">
                    <i class="fas fa-network-wired"></i> Network
                </div>
                <div class="settings-category" onclick="switchSettingsCategory('privacy')">
                    <i class="fas fa-shield-alt"></i> Privacy
                </div>
            </div>
            <div class="settings-main" id="settings-main">
                <div class="settings-section">
                    <h3>System Information</h3>
                    <div class="setting-item">
                        <label>OS Name</label>
                        <span>Triangulum OS</span>
                    </div>
                    <div class="setting-item">
                        <label>Version</label>
                        <span>1.0.0</span>
                    </div>
                    <div class="setting-item">
                        <label>Architecture</label>
                        <span>x64</span>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>System Preferences</h3>
                    <div class="setting-item">
                        <label>Auto-start applications</label>
                        <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                    </div>
                    <div class="setting-item">
                        <label>Show notifications</label>
                        <div class="toggle-switch active" onclick="toggleSwitch(this)"></div>
                    </div>
                    <div class="setting-item">
                        <label>Dark mode</label>
                        <div class="toggle-switch active" onclick="toggleSwitch(this)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-header">
            <div class="mobile-menu-logo">▲ TRIANGULUM OS</div>
            <button class="mobile-menu-close" onclick="toggleMobileMenu()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mobile-menu-apps">
            <div class="mobile-menu-app" onclick="openApp('file-manager'); toggleMobileMenu();">
                <i class="fas fa-folder"></i>
                <span>Files</span>
            </div>
            <div class="mobile-menu-app" onclick="openApp('terminal'); toggleMobileMenu();">
                <i class="fas fa-terminal"></i>
                <span>Terminal</span>
            </div>
            <div class="mobile-menu-app" onclick="openApp('browser'); toggleMobileMenu();">
                <i class="fas fa-globe"></i>
                <span>Browser</span>
            </div>
            <div class="mobile-menu-app" onclick="openApp('settings'); toggleMobileMenu();">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
            <div class="mobile-menu-app" onclick="openApp('calculator'); toggleMobileMenu();">
                <i class="fas fa-calculator"></i>
                <span>Calculator</span>
            </div>
            <div class="mobile-menu-app" onclick="openApp('editor'); toggleMobileMenu();">
                <i class="fas fa-file-alt"></i>
                <span>Editor</span>
            </div>
        </div>
    </div>

    <!-- Quick Actions (Mobile) -->
    <div class="quick-actions" id="quick-actions">
        <button class="quick-action-btn" onclick="toggleMobileMenu()" title="Menu">
            <i class="fas fa-bars"></i>
        </button>
        <button class="quick-action-btn" onclick="showAllWindows()" title="Show All Windows">
            <i class="fas fa-window-restore"></i>
        </button>
        <button class="quick-action-btn" onclick="closeAllWindows()" title="Close All">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <div class="taskbar-start" onclick="toggleStartMenu()" id="taskbar-start">
            <i class="fas fa-bars"></i>
        </div>
        <div class="taskbar-apps" id="taskbar-apps">
            <!-- Apps will be added here dynamically -->
        </div>
        <div class="taskbar-tray">
            <div class="tray-icon" title="Network">
                <i class="fas fa-wifi"></i>
            </div>
            <div class="tray-icon" title="Volume">
                <i class="fas fa-volume-up"></i>
            </div>
            <div class="tray-icon" title="Notifications" onclick="toggleQuickSettings()">
                <i class="fas fa-bell"></i>
            </div>
            <div class="tray-icon" title="Quick Settings" onclick="toggleQuickSettings()">
                <i class="fas fa-sliders-h"></i>
            </div>
            <div class="tray-time" id="tray-time"></div>
        </div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="start-menu">
        <div class="start-menu-header">
            <i class="fas fa-triangle"></i>
            <h2>Triangulum OS</h2>
        </div>
        <div class="start-menu-search">
            <input type="text" placeholder="Search applications..." id="start-search">
        </div>
        <div class="start-menu-apps">
            <div class="start-menu-app" onclick="openApp('file-manager'); toggleStartMenu();">
                <i class="fas fa-folder"></i>
                <span>File Manager</span>
            </div>
            <div class="start-menu-app" onclick="openApp('terminal'); toggleStartMenu();">
                <i class="fas fa-terminal"></i>
                <span>Terminal</span>
            </div>
            <div class="start-menu-app" onclick="openApp('browser'); toggleStartMenu();">
                <i class="fas fa-globe"></i>
                <span>Browser</span>
            </div>
            <div class="start-menu-app" onclick="openApp('settings'); toggleStartMenu();">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
            <div class="start-menu-app" onclick="openApp('calculator'); toggleStartMenu();">
                <i class="fas fa-calculator"></i>
                <span>Calculator</span>
            </div>
            <div class="start-menu-app" onclick="openApp('editor'); toggleStartMenu();">
                <i class="fas fa-file-alt"></i>
                <span>Text Editor</span>
            </div>
            <div class="start-menu-app" onclick="openApp('app-store'); toggleStartMenu();">
                <i class="fas fa-store"></i>
                <span>App Store</span>
            </div>
        </div>
        <div class="start-menu-footer">
            <button onclick="showNotification('Power', 'Power options coming soon!'); toggleStartMenu();">
                <i class="fas fa-power-off"></i> Power
            </button>
            <button onclick="toggleStartMenu()">
                <i class="fas fa-times"></i> Close
            </button>
        </div>
    </div>

    <!-- Calculator -->
    <div class="window" id="window-calculator" style="top: 200px; left: 300px; width: 350px; height: 500px;">
        <div class="window-header" onmousedown="startDrag(event, 'window-calculator')">
            <div class="window-title">
                <i class="fas fa-calculator"></i>
                <span>Calculator</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('calculator')" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="window-btn" onclick="maximizeWindow('calculator')" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="window-btn close" onclick="closeWindow('calculator')" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content">
            <div class="calculator" id="calculator">
                <div class="calc-display" id="calc-display">0</div>
                <button class="calc-btn clear" onclick="calcClear()">C</button>
                <button class="calc-btn" onclick="calcInput('(')">(</button>
                <button class="calc-btn" onclick="calcInput(')')">)</button>
                <button class="calc-btn operator" onclick="calcInput('/')">/</button>
                <button class="calc-btn" onclick="calcInput('7')">7</button>
                <button class="calc-btn" onclick="calcInput('8')">8</button>
                <button class="calc-btn" onclick="calcInput('9')">9</button>
                <button class="calc-btn operator" onclick="calcInput('*')">×</button>
                <button class="calc-btn" onclick="calcInput('4')">4</button>
                <button class="calc-btn" onclick="calcInput('5')">5</button>
                <button class="calc-btn" onclick="calcInput('6')">6</button>
                <button class="calc-btn operator" onclick="calcInput('-')">-</button>
                <button class="calc-btn" onclick="calcInput('1')">1</button>
                <button class="calc-btn" onclick="calcInput('2')">2</button>
                <button class="calc-btn" onclick="calcInput('3')">3</button>
                <button class="calc-btn operator" onclick="calcInput('+')">+</button>
                <button class="calc-btn" onclick="calcInput('0')">0</button>
                <button class="calc-btn" onclick="calcInput('.')">.</button>
                <button class="calc-btn equals" onclick="calcEquals()">=</button>
            </div>
        </div>
    </div>

    <!-- Text Editor -->
    <div class="window" id="window-editor" style="top: 100px; left: 200px; width: 800px; height: 600px;">
        <div class="window-header" onmousedown="startDrag(event, 'window-editor')">
            <div class="window-title">
                <i class="fas fa-file-alt"></i>
                <span id="editor-title">Text Editor - Untitled</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('editor')" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="window-btn" onclick="maximizeWindow('editor')" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="window-btn close" onclick="closeWindow('editor')" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content" style="display: flex; flex-direction: column; padding: 0;">
            <div class="editor-toolbar">
                <button class="editor-btn" onclick="editorNew()">
                    <i class="fas fa-file"></i> New
                </button>
                <button class="editor-btn" onclick="editorOpen()">
                    <i class="fas fa-folder-open"></i> Open
                </button>
                <button class="editor-btn" onclick="editorSave()">
                    <i class="fas fa-save"></i> Save
                </button>
                <button class="editor-btn" onclick="editorSaveAs()">
                    <i class="fas fa-save"></i> Save As
                </button>
            </div>
            <textarea class="editor-content" id="editor-content" placeholder="Start typing..."></textarea>
        </div>
    </div>

    <!-- App Store -->
    <div class="window" id="window-app-store" style="top: 120px; left: 200px; width: 900px; height: 700px;">
        <div class="window-header" onmousedown="startDrag(event, 'window-app-store')">
            <div class="window-title">
                <i class="fas fa-store"></i>
                <span>App Store</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('app-store')" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="window-btn" onclick="maximizeWindow('app-store')" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="window-btn close" onclick="closeWindow('app-store')" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content" style="padding: 0;">
            <div style="padding: 20px; border-bottom: 1px solid var(--os-border); background: var(--os-surface-light);">
                <h2 style="color: var(--os-primary); margin-bottom: 16px;">Triangulum App Store</h2>
                <input type="text" placeholder="Search apps..." id="app-store-search" 
                       style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid var(--os-border); border-radius: 6px; color: var(--os-text);">
            </div>
            <div style="padding: 20px; overflow-y: auto; height: calc(100% - 100px);">
                <div class="app-store-grid" id="app-store-grid">
                    <!-- Apps will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- App Store -->
    <div class="window" id="window-app-store" style="top: 120px; left: 200px; width: 900px; height: 700px;">
        <div class="window-header" onmousedown="startDrag(event, 'window-app-store')">
            <div class="window-title">
                <i class="fas fa-store"></i>
                <span>App Store</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('app-store')" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="window-btn" onclick="maximizeWindow('app-store')" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="window-btn close" onclick="closeWindow('app-store')" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content" style="padding: 0;">
            <div style="padding: 20px; border-bottom: 1px solid var(--os-border); background: var(--os-surface-light);">
                <h2 style="color: var(--os-primary); margin-bottom: 16px;">Triangulum App Store</h2>
                <input type="text" placeholder="Search apps..." id="app-store-search" 
                       style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid var(--os-border); border-radius: 6px; color: var(--os-text);">
            </div>
            <div style="padding: 20px; overflow-y: auto; height: calc(100% - 100px);">
                <div class="app-store-grid" id="app-store-grid">
                    <!-- Apps will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-header">
            <span class="notification-title" id="notification-title">Notification</span>
            <button class="notification-close" onclick="hideNotification()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notification-body" id="notification-body">
            Notification message
        </div>
    </div>

    <!-- App Switcher (Alt+Tab) -->
    <div class="app-switcher" id="app-switcher">
        <div class="app-switcher-content">
            <h3>Running Applications</h3>
            <div class="app-switcher-list" id="app-switcher-list"></div>
            <div class="app-switcher-hint">Press Alt+Tab to switch</div>
        </div>
    </div>

    <!-- Quick Settings Panel -->
    <div class="quick-settings" id="quick-settings">
        <div class="quick-settings-header">
            <h3>Quick Settings</h3>
            <button onclick="toggleQuickSettings()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="quick-settings-content">
            <div class="quick-setting-item">
                <label>Wi-Fi</label>
                <div class="toggle-switch active" onclick="toggleQuickSetting('wifi', this)"></div>
            </div>
            <div class="quick-setting-item">
                <label>Bluetooth</label>
                <div class="toggle-switch" onclick="toggleQuickSetting('bluetooth', this)"></div>
            </div>
            <div class="quick-setting-item">
                <label>Dark Mode</label>
                <div class="toggle-switch active" onclick="toggleQuickSetting('darkMode', this)"></div>
            </div>
            <div class="quick-setting-item">
                <label>Notifications</label>
                <div class="toggle-switch active" onclick="toggleQuickSetting('notifications', this)"></div>
            </div>
            <div class="quick-setting-item">
                <label>Auto-lock</label>
                <div class="toggle-switch" onclick="toggleQuickSetting('autolock', this)"></div>
            </div>
        </div>
    </div>

<script>
// File System (localStorage based)
const fileSystem = {
    currentPath: '/home/triangulum',
    files: JSON.parse(localStorage.getItem('triangulum-fs') || '{}'),
    
    init() {
        if (Object.keys(this.files).length === 0) {
            this.files = {
                '/home/triangulum/Documents': { type: 'folder', children: [] },
                '/home/triangulum/Downloads': { type: 'folder', children: [] },
                '/home/triangulum/Pictures': { type: 'folder', children: [] },
                '/home/triangulum/Music': { type: 'folder', children: [] },
                '/home/triangulum/Documents/readme.txt': { type: 'file', content: 'Welcome to Triangulum OS!' },
                '/home/triangulum/Documents/notes.txt': { type: 'file', content: 'My notes here...' }
            };
            this.save();
        }
    },
    
    save() {
        localStorage.setItem('triangulum-fs', JSON.stringify(this.files));
    },
    
    list(path) {
        const items = [];
        for (const key in this.files) {
            if (key.startsWith(path + '/') && key.split('/').length === path.split('/').length + 1) {
                items.push(key.split('/').pop());
            }
        }
        return items;
    },
    
    read(path) {
        return this.files[path]?.content || '';
    },
    
    write(path, content) {
        this.files[path] = { type: 'file', content };
        this.save();
    },
    
    createFolder(path) {
        this.files[path] = { type: 'folder', children: [] };
        this.save();
    }
};

// Boot Screen
function hideBootScreen() {
    setTimeout(() => {
        const bootScreen = document.getElementById('boot-screen');
        if (bootScreen) {
            bootScreen.style.opacity = '0';
            bootScreen.style.transition = 'opacity 0.5s ease-out';
            setTimeout(() => {
                bootScreen.classList.add('hidden');
                initOS();
            }, 500);
        }
    }, 3000); // Show boot screen for 3 seconds
}

// Browser History
let browserHistory = [];
let browserHistoryIndex = -1;

// Calculator State
let calcDisplay = '0';
let calcExpression = '';

// Editor State
let editorCurrentFile = null;
let editorContent = '';

// OS State
const osState = {
    windows: {},
    activeWindow: null,
    dragging: null,
    dragOffset: { x: 0, y: 0 }
};

// Initialize OS
function initOS() {
    fileSystem.init();
    updateTime();
    setInterval(updateTime, 1000);
    loadFileManager();
    loadSettings();
    
    // Terminal input handler
    const terminalInput = document.getElementById('terminal-input');
    if (terminalInput) {
        terminalInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleTerminalCommand(terminalInput.value);
                terminalInput.value = '';
            }
        });
    }
    
    // Browser URL enter
    const browserUrl = document.getElementById('browser-url');
    if (browserUrl) {
        browserUrl.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                browserGo();
            }
        });
    }
    
    // Editor auto-save
    const editorContent = document.getElementById('editor-content');
    if (editorContent) {
        editorContent.addEventListener('input', () => {
            editorContent = editorContent.value;
        });
    }
    
    // Click outside to close start menu
    document.addEventListener('click', (e) => {
        const startMenu = document.getElementById('start-menu');
        const mobileMenu = document.getElementById('mobile-menu');
        const startButton = document.getElementById('taskbar-start');
        const quickActions = document.getElementById('quick-actions');
        
        if (startMenu && !startMenu.contains(e.target) && startButton && !startButton.contains(e.target)) {
            startMenu.classList.remove('active');
        }
        
        if (mobileMenu && !mobileMenu.contains(e.target) && quickActions && !quickActions.contains(e.target) && startButton && !startButton.contains(e.target)) {
            mobileMenu.classList.remove('active');
        }
    });
    
    // Handle window resize
    window.addEventListener('resize', () => {
        // Close menus on resize
        const startMenu = document.getElementById('start-menu');
        const mobileMenu = document.getElementById('mobile-menu');
        if (startMenu) startMenu.classList.remove('active');
        if (mobileMenu) mobileMenu.classList.remove('active');
        
        // Adjust windows for mobile
        if (window.innerWidth <= 768) {
            document.querySelectorAll('.window.active').forEach(window => {
                window.style.top = '0';
                window.style.left = '0';
                window.style.width = '100%';
                window.style.height = `calc(100vh - ${getComputedStyle(document.documentElement).getPropertyValue('--taskbar-height')})`;
            });
        }
    });
    
    // Prevent zoom on double tap (mobile)
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
            e.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
}

// Time update
function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        hour12: true 
    });
    const timeEl = document.getElementById('tray-time');
    if (timeEl) timeEl.textContent = timeStr;
}

// Start Menu
function toggleStartMenu() {
    const menu = document.getElementById('start-menu');
    const mobileMenu = document.getElementById('mobile-menu');
    
    // On mobile, show mobile menu instead
    if (window.innerWidth <= 768) {
        toggleMobileMenu();
        return;
    }
    
    menu.classList.toggle('active');
    if (mobileMenu) mobileMenu.classList.remove('active');
}

// Mobile Menu
function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const startMenu = document.getElementById('start-menu');
    
    if (menu) {
        menu.classList.toggle('active');
    }
    if (startMenu) {
        startMenu.classList.remove('active');
    }
}

// Show All Windows
function showAllWindows() {
    document.querySelectorAll('.window').forEach(window => {
        if (window.classList.contains('minimized')) {
            const appId = window.id.replace('window-', '');
            openApp(appId);
        }
    });
    showNotification('Windows', 'All windows restored');
}

// Close All Windows
function closeAllWindows() {
    document.querySelectorAll('.window.active').forEach(window => {
        const appId = window.id.replace('window-', '');
        closeWindow(appId);
    });
    showNotification('Windows', 'All windows closed');
}

// Open Application
function openApp(appId) {
    const window = document.getElementById(`window-${appId}`);
    if (!window) {
        console.error(`Window not found: window-${appId}`);
        return;
    }
    
    // Remove minimized state
    window.classList.remove('minimized');
    
    // Show window - make sure it's visible
    window.classList.add('active');
    window.style.display = 'flex';
    window.style.visibility = 'visible';
    window.style.opacity = '1';
    
    // Position window properly - ensure it fits on screen
    const winWidth = parseInt(window.style.width || window.offsetWidth || 800);
    const winHeight = parseInt(window.style.height || window.offsetHeight || 600);
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight - parseInt(getComputedStyle(document.documentElement).getPropertyValue('--taskbar-height')) - 20;
    
    // Calculate center position
    let centerX = (viewportWidth - winWidth) / 2;
    let centerY = (viewportHeight - winHeight) / 2;
    
    // Ensure window doesn't go off screen
    centerX = Math.max(10, Math.min(centerX, viewportWidth - winWidth - 10));
    centerY = Math.max(10, Math.min(centerY, viewportHeight - winHeight - 10));
    
    // Apply position
    window.style.top = `${centerY}px`;
    window.style.left = `${centerX}px`;
    
    // Ensure window size fits viewport
    if (winWidth > viewportWidth) {
        window.style.width = `${viewportWidth - 20}px`;
    }
    if (winHeight > viewportHeight) {
        window.style.height = `${viewportHeight - 20}px`;
    }
    
    // Update active window
    osState.activeWindow = appId;
    updateWindowZIndex();
    
    // Add to taskbar
    addToTaskbar(appId);
    
    // Focus window
    focusWindow(appId);
    
    // Focus input if terminal
    if (appId === 'terminal') {
        setTimeout(() => {
            const input = document.getElementById('terminal-input');
            if (input) input.focus();
        }, 100);
    }
    
    // Show browser home if browser
    if (appId === 'browser') {
        setTimeout(() => {
            showBrowserHome();
            const searchBox = document.getElementById('browser-search-box');
            if (searchBox) searchBox.focus();
        }, 100);
    }
    
    // Load app store if app store
    if (appId === 'app-store') {
        setTimeout(() => {
            loadAppStore();
        }, 100);
    }
}

// Close Window
function closeWindow(appId, e) {
    if (e) {
        e.stopPropagation();
        e.preventDefault();
    }
    const windowEl = document.getElementById(`window-${appId}`);
    if (windowEl) {
        windowEl.classList.remove('active');
        windowEl.classList.add('minimized');
        windowEl.style.display = 'none';
        windowEl.style.visibility = 'hidden';
        windowEl.style.opacity = '0';
    }
    removeFromTaskbar(appId);
    if (osState.activeWindow === appId) {
        osState.activeWindow = null;
    }
}

// Minimize Window
function minimizeWindow(appId, e) {
    if (e) {
        e.stopPropagation();
        e.preventDefault();
    }
    const windowEl = document.getElementById(`window-${appId}`);
    if (windowEl) {
        windowEl.classList.add('minimized');
        windowEl.classList.remove('active');
        windowEl.style.display = 'none';
        windowEl.style.visibility = 'hidden';
    }
    updateTaskbarActive(appId, false);
    if (osState.activeWindow === appId) {
        osState.activeWindow = null;
    }
}

// Maximize Window
function maximizeWindow(appId) {
    const window = document.getElementById(`window-${appId}`);
    if (window) {
        window.classList.toggle('maximized');
        const btn = window.querySelector('.window-btn i.fa-square');
        if (btn) {
            btn.classList.toggle('fa-square');
            btn.classList.toggle('fa-window-restore');
        }
    }
}

// Window Dragging
function startDrag(e, windowId) {
    const window = document.getElementById(windowId);
    if (!window || window.classList.contains('maximized')) return;
    
    osState.dragging = windowId;
    const rect = window.getBoundingClientRect();
    osState.dragOffset.x = e.clientX - rect.left;
    osState.dragOffset.y = e.clientY - rect.top;
    
    focusWindow(windowId.replace('window-', ''));
}

document.addEventListener('mousemove', (e) => {
    if (osState.dragging) {
        const window = document.getElementById(osState.dragging);
        if (window && !window.classList.contains('maximized')) {
            const x = e.clientX - osState.dragOffset.x;
            const y = e.clientY - osState.dragOffset.y;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight - parseInt(getComputedStyle(document.documentElement).getPropertyValue('--taskbar-height'));
            const winWidth = window.offsetWidth;
            const winHeight = window.offsetHeight;
            
            // Constrain window within viewport
            const maxX = viewportWidth - winWidth;
            const maxY = viewportHeight - winHeight;
            
            window.style.left = `${Math.max(0, Math.min(x, maxX))}px`;
            window.style.top = `${Math.max(0, Math.min(y, maxY))}px`;
        }
    }
});

document.addEventListener('mouseup', () => {
    osState.dragging = null;
});

// Focus Window
function focusWindow(appId) {
    // Remove active from all windows
    document.querySelectorAll('.window').forEach(w => {
        w.classList.remove('active');
    });
    
    // Add active to this window
    const window = document.getElementById(`window-${appId}`);
    if (window && !window.classList.contains('minimized')) {
        window.classList.add('active');
        window.classList.remove('minimized');
        window.style.display = 'flex';
        window.style.visibility = 'visible';
    }
    
    updateWindowZIndex();
    updateTaskbarActive(appId, true);
}

// Update Window Z-Index
function updateWindowZIndex() {
    let zIndex = 100;
    document.querySelectorAll('.window.active').forEach(w => {
        w.style.zIndex = zIndex++;
    });
}

// Taskbar Management
function addToTaskbar(appId) {
    const taskbarApps = document.getElementById('taskbar-apps');
    if (!taskbarApps) return;
    
    // Check if already exists
    if (document.getElementById(`taskbar-${appId}`)) return;
    
    const appNames = {
        'file-manager': { name: 'File Manager', icon: 'fa-folder' },
        'terminal': { name: 'Terminal', icon: 'fa-terminal' },
        'browser': { name: 'TRIANGULUM BROWSER', icon: 'fa-globe' },
        'settings': { name: 'Settings', icon: 'fa-cog' },
        'calculator': { name: 'Calculator', icon: 'fa-calculator' },
        'editor': { name: 'Text Editor', icon: 'fa-file-alt' },
        'app-store': { name: 'App Store', icon: 'fa-store' }
    };
    
    const app = appNames[appId];
    if (!app) return;
    
    const appEl = document.createElement('div');
    appEl.className = 'taskbar-app';
    appEl.id = `taskbar-${appId}`;
    appEl.onclick = () => {
        const window = document.getElementById(`window-${appId}`);
        if (window && window.classList.contains('minimized')) {
            openApp(appId);
        } else {
            focusWindow(appId);
        }
    };
    appEl.innerHTML = `
        <i class="fas ${app.icon}"></i>
        <span>${app.name}</span>
    `;
    
    taskbarApps.appendChild(appEl);
}

function removeFromTaskbar(appId) {
    const appEl = document.getElementById(`taskbar-${appId}`);
    if (appEl) appEl.remove();
}

function updateTaskbarActive(appId, active) {
    const appEl = document.getElementById(`taskbar-${appId}`);
    if (appEl) {
        if (active) {
            appEl.classList.add('active');
        } else {
            appEl.classList.remove('active');
        }
    }
}

// Terminal Commands
function handleTerminalCommand(cmd) {
    const content = document.getElementById('terminal-content');
    if (!content) return;
    
    // Add command to history
    const inputLine = content.querySelector('.terminal-input-line');
    const newLine = document.createElement('div');
    newLine.className = 'terminal-line';
    newLine.innerHTML = `<span class="terminal-prompt">triangulum@os:~$</span> ${cmd}`;
    inputLine.parentNode.insertBefore(newLine, inputLine);
    
    // Process command
    const output = processCommand(cmd);
    if (output) {
        const outputLine = document.createElement('div');
        outputLine.className = 'terminal-line';
        outputLine.textContent = output;
        inputLine.parentNode.insertBefore(outputLine, inputLine);
    }
    
    // Scroll to bottom
    content.scrollTop = content.scrollHeight;
}

function processCommand(cmd) {
    const parts = cmd.trim().split(' ');
    const command = parts[0].toLowerCase();
    const args = parts.slice(1);
    
    switch (command) {
        case 'help':
            return `Available commands:
help       - Show this help message
clear      - Clear terminal
date       - Show current date and time
whoami     - Show current user
uname      - Show system information
ls [dir]   - List files and directories
cd [dir]   - Change directory
pwd        - Show current directory
cat [file] - Display file contents
mkdir [dir]- Create directory
touch [file]- Create file
rm [file]  - Remove file
echo [text]- Echo text
calc [expr]- Calculate expression
open [app] - Open application
exit       - Close terminal`;
        
        case 'clear':
            const content = document.getElementById('terminal-content');
            const inputLine = content.querySelector('.terminal-input-line');
            content.innerHTML = '';
            content.appendChild(inputLine);
            return null;
        
        case 'date':
            return new Date().toString();
        
        case 'whoami':
            return 'triangulum';
        
        case 'uname':
            return 'Triangulum OS 1.0.0 x64';
        
        case 'ls':
            const path = args[0] || fileSystem.currentPath;
            const items = fileSystem.list(path);
            return items.length > 0 ? items.join('  ') : '(empty)';
        
        case 'cd':
            if (args[0]) {
                const newPath = args[0].startsWith('/') ? args[0] : fileSystem.currentPath + '/' + args[0];
                if (fileSystem.files[newPath]?.type === 'folder') {
                    fileSystem.currentPath = newPath;
                    return '';
                } else {
                    return `cd: ${args[0]}: No such file or directory`;
                }
            } else {
                fileSystem.currentPath = '/home/triangulum';
                return '';
            }
        
        case 'pwd':
            return fileSystem.currentPath;
        
        case 'cat':
            if (args[0]) {
                const filePath = args[0].startsWith('/') ? args[0] : fileSystem.currentPath + '/' + args[0];
                const content = fileSystem.read(filePath);
                return content || `cat: ${args[0]}: No such file or directory`;
            }
            return 'cat: missing file operand';
        
        case 'mkdir':
            if (args[0]) {
                const dirPath = args[0].startsWith('/') ? args[0] : fileSystem.currentPath + '/' + args[0];
                fileSystem.createFolder(dirPath);
                return '';
            }
            return 'mkdir: missing operand';
        
        case 'touch':
            if (args[0]) {
                const filePath = args[0].startsWith('/') ? args[0] : fileSystem.currentPath + '/' + args[0];
                fileSystem.write(filePath, '');
                return '';
            }
            return 'touch: missing operand';
        
        case 'rm':
            if (args[0]) {
                const filePath = args[0].startsWith('/') ? args[0] : fileSystem.currentPath + '/' + args[0];
                if (fileSystem.files[filePath]) {
                    delete fileSystem.files[filePath];
                    fileSystem.save();
                    return '';
                }
                return `rm: ${args[0]}: No such file or directory`;
            }
            return 'rm: missing operand';
        
        case 'echo':
            return args.join(' ');
        
        case 'calc':
            try {
                const expr = args.join(' ');
                const result = Function('"use strict"; return (' + expr + ')')();
                return result.toString();
            } catch (e) {
                return 'calc: invalid expression';
            }
        
        case 'open':
            if (args[0]) {
                const appMap = {
                    'files': 'file-manager',
                    'terminal': 'terminal',
                    'browser': 'browser',
                    'settings': 'settings',
                    'calc': 'calculator',
                    'editor': 'editor'
                };
                const appId = appMap[args[0].toLowerCase()];
                if (appId) {
                    openApp(appId);
                    return `Opening ${args[0]}...`;
                }
                return `open: unknown application: ${args[0]}`;
            }
            return 'open: missing application name';
        
        case 'exit':
            closeWindow('terminal');
            return null;
        
        default:
            return `Command not found: ${command}. Type 'help' for available commands.`;
    }
}

// Browser Functions
function browserGoBack() {
    if (browserHistoryIndex > 0) {
        browserHistoryIndex--;
        const url = browserHistory[browserHistoryIndex];
        document.getElementById('browser-url').value = url;
        loadBrowserPage(url);
    }
}

function browserGoForward() {
    if (browserHistoryIndex < browserHistory.length - 1) {
        browserHistoryIndex++;
        const url = browserHistory[browserHistoryIndex];
        document.getElementById('browser-url').value = url;
        loadBrowserPage(url);
    }
}

function browserRefresh() {
    const urlInput = document.getElementById('browser-url');
    const url = urlInput ? urlInput.value.trim() : '';
    if (url) {
        loadBrowserPage(url);
    } else {
        showBrowserHome();
    }
}

function browserGo() {
    let url = document.getElementById('browser-url').value.trim();
    if (!url) return;
    
    // Check if it's a search query (no dots, spaces, or protocol)
    if (!url.includes('.') && !url.startsWith('http://') && !url.startsWith('https://')) {
        performWebSearch(url);
        return;
    }
    
    // Add protocol if missing
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
    }
    
    // Add to history
    browserHistory = browserHistory.slice(0, browserHistoryIndex + 1);
    browserHistory.push(url);
    browserHistoryIndex = browserHistory.length - 1;
    
    loadBrowserPage(url);
}

// Real Web Search Function
async function performWebSearch(query) {
    const searchBox = document.getElementById('browser-search-box');
    const urlInput = document.getElementById('browser-url');
    
    // Get search query from multiple sources
    let searchQuery = query;
    if (!searchQuery && searchBox) {
        searchQuery = searchBox.value.trim();
    }
    if (!searchQuery && urlInput) {
        searchQuery = urlInput.value.trim();
    }
    
    if (!searchQuery) {
        showNotification('Browser', 'Please enter a search query');
        return;
    }
    
    const content = document.getElementById('browser-content');
    const home = document.getElementById('browser-home');
    const results = document.getElementById('browser-search-results');
    
    // Clear previous content
    if (content) {
        const oldIframe = content.querySelector('iframe');
        if (oldIframe) oldIframe.remove();
    }
    
    // Update URL bar
    if (urlInput) urlInput.value = searchQuery;
    if (searchBox) searchBox.value = searchQuery;
    
    // Show loading
    if (home) home.style.display = 'none';
    if (results) {
        results.style.display = 'block';
        results.innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fas fa-spinner fa-spin" style="font-size: 48px; color: var(--os-primary);"></i><p style="margin-top: 20px;">Searching the web...</p></div>';
    }
    
    // Use DuckDuckGo HTML search - always use iframe for reliability
    const searchUrl = `https://html.duckduckgo.com/html/?q=${encodeURIComponent(searchQuery)}`;
    
    // Always use iframe for search - most reliable method
    if (results) {
        results.innerHTML = `
            <div style="text-align: center; padding: 20px; background: #f5f5f5; border-bottom: 1px solid #ddd; margin-bottom: 0;">
                <h2 style="color: #333; margin-bottom: 10px;">Search Results for: "${searchQuery}"</h2>
                <p style="color: #666;">Loading real-time search results...</p>
            </div>
            <iframe id="search-iframe" src="${searchUrl}" 
                    style="width: 100%; height: calc(100vh - 350px); min-height: 600px; border: none;"
                    allow="fullscreen"
                    loading="lazy"></iframe>
        `;
    }
    
    // Add to history
    browserHistory = browserHistory.slice(0, browserHistoryIndex + 1);
    browserHistory.push(searchUrl);
    browserHistoryIndex = browserHistory.length - 1;
    
    // Update URL bar with search URL
    if (urlInput) urlInput.value = searchUrl;
}

function loadBrowserPage(url) {
    if (!url || url === '#') return;
    
    const content = document.getElementById('browser-content');
    const home = document.getElementById('browser-home');
    const results = document.getElementById('browser-search-results');
    
    // Hide home and results
    if (home) home.style.display = 'none';
    if (results) results.style.display = 'none';
    
    // Clear previous iframes
    if (content) {
        const oldIframe = content.querySelector('iframe');
        if (oldIframe) oldIframe.remove();
    }
    
    // Show loading
    if (content) {
        content.innerHTML = '<div style="text-align: center; padding: 50px;"><i class="fas fa-spinner fa-spin" style="font-size: 48px; color: var(--os-primary);"></i><p style="margin-top: 20px;">Loading...</p></div>';
    }
    
    // Ensure URL has protocol
    let finalUrl = url;
    if (!finalUrl.startsWith('http://') && !finalUrl.startsWith('https://')) {
        finalUrl = 'https://' + finalUrl;
    }
    
    // Update URL bar
    const urlInput = document.getElementById('browser-url');
    if (urlInput) urlInput.value = finalUrl;
    
    // Use iframe for real browsing
    setTimeout(() => {
        if (content) {
            const iframe = document.createElement('iframe');
            iframe.id = 'browser-iframe';
            iframe.style.width = '100%';
            iframe.style.height = 'calc(100vh - 300px)';
            iframe.style.minHeight = '600px';
            iframe.style.border = 'none';
            iframe.style.background = 'white';
            iframe.src = finalUrl;
            iframe.allow = 'fullscreen';
            iframe.loading = 'lazy';
            iframe.onload = () => {
                console.log('Page loaded:', finalUrl);
            };
            iframe.onerror = () => {
                content.innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <h2 style="color: var(--os-error);">Unable to load page</h2>
                        <p>Due to browser security restrictions, some websites cannot be loaded in an iframe.</p>
                        <p style="margin: 20px 0;">URL: <a href="${finalUrl}" target="_blank" style="color: var(--os-primary); text-decoration: underline;">${finalUrl}</a></p>
                        <p>Click the link above to open in a new tab.</p>
                        <button onclick="showBrowserHome()" style="margin-top: 20px; padding: 10px 20px; background: var(--os-primary); color: white; border: none; border-radius: 6px; cursor: pointer;">Go to Home</button>
                    </div>
                `;
            };
            content.innerHTML = '';
            content.appendChild(iframe);
        }
    }, 100);
}

function showBrowserHome() {
    const home = document.getElementById('browser-home');
    const results = document.getElementById('browser-search-results');
    const content = document.getElementById('browser-content');
    
    if (home) home.style.display = 'block';
    if (results) results.style.display = 'none';
    
    // Clear iframe if exists
    if (content) {
        const iframe = content.querySelector('iframe');
        if (iframe) {
            iframe.remove();
        }
        content.innerHTML = '';
    }
    
    const urlInput = document.getElementById('browser-url');
    const searchBox = document.getElementById('browser-search-box');
    if (urlInput) urlInput.value = '';
    if (searchBox) searchBox.value = '';
}

// File Manager
function loadFileManager() {
    const main = document.querySelector('.file-manager-main .file-grid');
    if (!main) return;
    
    main.innerHTML = '';
    const items = fileSystem.list(fileSystem.currentPath);
    items.forEach(item => {
        const fullPath = fileSystem.currentPath + '/' + item;
        const isFolder = fileSystem.files[fullPath]?.type === 'folder';
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.onclick = () => {
            if (isFolder) {
                navigateToFolder(fullPath);
            } else {
                openFileInEditor(fullPath);
            }
        };
        fileItem.innerHTML = `
            <i class="fas ${isFolder ? 'fa-folder' : 'fa-file'}"></i>
            <span>${item}</span>
        `;
        main.appendChild(fileItem);
    });
}

function navigateToFolder(path) {
    if (fileSystem.files[path]?.type === 'folder') {
        fileSystem.currentPath = path;
        loadFileManager();
    }
}

function openFileInEditor(path) {
    openApp('editor');
    editorCurrentFile = path;
    editorContent = fileSystem.read(path);
    document.getElementById('editor-content').value = editorContent;
    document.getElementById('editor-title').textContent = `Text Editor - ${path.split('/').pop()}`;
}

// Settings
let settingsData = JSON.parse(localStorage.getItem('triangulum-settings') || '{}');

function switchSettingsCategory(category) {
    document.querySelectorAll('.settings-category').forEach(c => c.classList.remove('active'));
    event.target.closest('.settings-category').classList.add('active');
    
    const main = document.getElementById('settings-main');
    let html = '';
    
    switch(category) {
        case 'system':
            html = `
                <div class="settings-section">
                    <h3>System Information</h3>
                    <div class="setting-item">
                        <label>OS Name</label>
                        <span>Triangulum OS</span>
                    </div>
                    <div class="setting-item">
                        <label>Version</label>
                        <span>1.0.0</span>
                    </div>
                    <div class="setting-item">
                        <label>Architecture</label>
                        <span>x64</span>
                    </div>
                    <div class="setting-item">
                        <label>Uptime</label>
                        <span id="uptime">Calculating...</span>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>System Preferences</h3>
                    <div class="setting-item">
                        <label>Auto-start applications</label>
                        <div class="toggle-switch ${settingsData.autoStart ? 'active' : ''}" onclick="toggleSetting('autoStart', this)"></div>
                    </div>
                    <div class="setting-item">
                        <label>Show notifications</label>
                        <div class="toggle-switch ${settingsData.showNotifications !== false ? 'active' : ''}" onclick="toggleSetting('showNotifications', this)"></div>
                    </div>
                    <div class="setting-item">
                        <label>Dark mode</label>
                        <div class="toggle-switch active" onclick="toggleSetting('darkMode', this)"></div>
                    </div>
                </div>
            `;
            break;
        case 'display':
            html = `
                <div class="settings-section">
                    <h3>Display Settings</h3>
                    <div class="setting-item">
                        <label>Resolution</label>
                        <span>${window.screen.width}x${window.screen.height}</span>
                    </div>
                    <div class="setting-item">
                        <label>Theme</label>
                        <span>Dark</span>
                    </div>
                </div>
            `;
            break;
        case 'network':
            const isOnline = navigator.onLine;
            const connectionType = navigator.connection ? navigator.connection.effectiveType : 'Unknown';
            const downlink = navigator.connection ? navigator.connection.downlink + ' Mbps' : 'Unknown';
            html = `
                <div class="settings-section">
                    <h3>Network Status</h3>
                    <div class="setting-item">
                        <label>Connection Status</label>
                        <span style="color: ${isOnline ? 'var(--os-success)' : 'var(--os-error)'};">
                            <i class="fas fa-${isOnline ? 'wifi' : 'wifi-slash'}"></i> ${isOnline ? 'Online' : 'Offline'}
                        </span>
                    </div>
                    <div class="setting-item">
                        <label>Connection Type</label>
                        <span>${connectionType}</span>
                    </div>
                    <div class="setting-item">
                        <label>Download Speed</label>
                        <span>${downlink}</span>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Network Preferences</h3>
                    <div class="setting-item">
                        <label>Wi-Fi</label>
                        <div class="toggle-switch ${isOnline ? 'active' : ''}" onclick="toggleNetworkSetting('wifi', this)"></div>
                    </div>
                    <div class="setting-item">
                        <label>Bluetooth</label>
                        <div class="toggle-switch" onclick="toggleNetworkSetting('bluetooth', this)"></div>
                    </div>
                    <div class="setting-item">
                        <label>Airplane Mode</label>
                        <div class="toggle-switch" onclick="toggleNetworkSetting('airplane', this)"></div>
                    </div>
                    <div class="setting-item">
                        <label>Data Saver</label>
                        <div class="toggle-switch" onclick="toggleNetworkSetting('dataSaver', this)"></div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Network Information</h3>
                    <div class="setting-item">
                        <label>IP Address</label>
                        <button onclick="getIPAddress()" style="padding: 6px 12px; background: var(--os-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Get IP</button>
                        <span id="ip-address" style="margin-left: 10px;"></span>
                    </div>
                    <div class="setting-item">
                        <label>Network Test</label>
                        <button onclick="testNetwork()" style="padding: 6px 12px; background: var(--os-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Test Connection</button>
                        <span id="network-test" style="margin-left: 10px;"></span>
                    </div>
                </div>
            `;
            break;
        case 'privacy':
            html = `
                <div class="settings-section">
                    <h3>Privacy Settings</h3>
                    <div class="setting-item">
                        <label>Data Collection</label>
                        <div class="toggle-switch" onclick="toggleSetting('dataCollection', this)"></div>
                    </div>
                </div>
            `;
            break;
    }
    
    main.innerHTML = html;
    if (category === 'system') {
        updateUptime();
        setInterval(updateUptime, 1000);
    }
}

function loadSettings() {
    if (settingsData.system) {
        switchSettingsCategory('system');
    }
}

function toggleSetting(key, el) {
    el.classList.toggle('active');
    settingsData[key] = el.classList.contains('active');
    localStorage.setItem('triangulum-settings', JSON.stringify(settingsData));
    showNotification('Settings', `${key} ${settingsData[key] ? 'enabled' : 'disabled'}`);
}

function updateUptime() {
    const startTime = parseInt(localStorage.getItem('os-start-time') || Date.now());
    const uptime = Math.floor((Date.now() - startTime) / 1000);
    const hours = Math.floor(uptime / 3600);
    const minutes = Math.floor((uptime % 3600) / 60);
    const seconds = uptime % 60;
    const uptimeEl = document.getElementById('uptime');
    if (uptimeEl) {
        uptimeEl.textContent = `${hours}h ${minutes}m ${seconds}s`;
    }
}

// Calculator Functions
function calcInput(value) {
    if (calcDisplay === '0' && value !== '.') {
        calcDisplay = value;
    } else {
        calcDisplay += value;
    }
    document.getElementById('calc-display').textContent = calcDisplay;
}

function calcClear() {
    calcDisplay = '0';
    calcExpression = '';
    document.getElementById('calc-display').textContent = calcDisplay;
}

function calcEquals() {
    try {
        const result = Function('"use strict"; return (' + calcDisplay.replace('×', '*') + ')')();
        calcDisplay = result.toString();
        calcExpression = calcDisplay;
        document.getElementById('calc-display').textContent = calcDisplay;
    } catch (e) {
        calcDisplay = 'Error';
        document.getElementById('calc-display').textContent = calcDisplay;
        setTimeout(calcClear, 2000);
    }
}

// Editor Functions
function editorNew() {
    editorCurrentFile = null;
    editorContent = '';
    document.getElementById('editor-content').value = '';
    document.getElementById('editor-title').textContent = 'Text Editor - Untitled';
}

function editorOpen() {
    const fileName = prompt('Enter file name:');
    if (fileName) {
        const filePath = fileSystem.currentPath + '/' + fileName;
        const content = fileSystem.read(filePath);
        if (content !== '') {
            editorCurrentFile = filePath;
            editorContent = content;
            document.getElementById('editor-content').value = content;
            document.getElementById('editor-title').textContent = `Text Editor - ${fileName}`;
        } else {
            showNotification('Editor', 'File not found');
        }
    }
}

function editorSave() {
    const content = document.getElementById('editor-content').value;
    if (editorCurrentFile) {
        fileSystem.write(editorCurrentFile, content);
        showNotification('Editor', 'File saved');
    } else {
        editorSaveAs();
    }
}

function editorSaveAs() {
    const fileName = prompt('Enter file name:');
    if (fileName) {
        const filePath = fileSystem.currentPath + '/' + fileName;
        const content = document.getElementById('editor-content').value;
        fileSystem.write(filePath, content);
        editorCurrentFile = filePath;
        document.getElementById('editor-title').textContent = `Text Editor - ${fileName}`;
        showNotification('Editor', 'File saved');
        loadFileManager();
    }
}

// Notifications
function showNotification(title, message) {
    const notification = document.getElementById('notification');
    document.getElementById('notification-title').textContent = title;
    document.getElementById('notification-body').textContent = message;
    notification.classList.add('active');
    
    setTimeout(() => {
        hideNotification();
    }, 3000);
}

function hideNotification() {
    document.getElementById('notification').classList.remove('active');
}

// App Switcher
function showAppSwitcher() {
    const switcher = document.getElementById('app-switcher');
    const list = document.getElementById('app-switcher-list');
    
    if (!switcher || !list) return;
    
    list.innerHTML = '';
    const runningApps = [];
    
    document.querySelectorAll('.window.active, .window:not(.minimized)').forEach(window => {
        const appId = window.id.replace('window-', '');
        const appNames = {
            'file-manager': { name: 'File Manager', icon: 'fa-folder' },
            'terminal': { name: 'Terminal', icon: 'fa-terminal' },
            'browser': { name: 'TRIANGULUM BROWSER', icon: 'fa-globe' },
            'settings': { name: 'Settings', icon: 'fa-cog' },
            'calculator': { name: 'Calculator', icon: 'fa-calculator' },
            'editor': { name: 'Text Editor', icon: 'fa-file-alt' }
        };
        
        const app = appNames[appId];
        if (app) {
            runningApps.push({ id: appId, ...app });
        }
    });
    
    if (runningApps.length === 0) {
        list.innerHTML = '<div style="text-align: center; color: var(--os-text-dim); padding: 20px;">No applications running</div>';
    } else {
        runningApps.forEach((app, index) => {
            const item = document.createElement('div');
            item.className = 'app-switcher-item';
            if (index === 0) item.classList.add('active');
            item.onclick = () => {
                openApp(app.id);
                hideAppSwitcher();
            };
            item.innerHTML = `
                <i class="fas ${app.icon}"></i>
                <span>${app.name}</span>
            `;
            list.appendChild(item);
        });
    }
    
    switcher.classList.add('active');
}

function hideAppSwitcher() {
    const switcher = document.getElementById('app-switcher');
    if (switcher) switcher.classList.remove('active');
}

// Quick Settings
function toggleQuickSettings() {
    const panel = document.getElementById('quick-settings');
    if (panel) panel.classList.toggle('active');
}

function toggleQuickSetting(key, el) {
    el.classList.toggle('active');
    const isActive = el.classList.contains('active');
    showNotification('Settings', `${key} ${isActive ? 'enabled' : 'disabled'}`);
    // Save to localStorage
    const quickSettings = JSON.parse(localStorage.getItem('quick-settings') || '{}');
    quickSettings[key] = isActive;
    localStorage.setItem('quick-settings', JSON.stringify(quickSettings));
}

// Keyboard Shortcuts
document.addEventListener('keydown', (e) => {
    // Alt+Tab for app switcher
    if (e.altKey && e.key === 'Tab') {
        e.preventDefault();
        showAppSwitcher();
    }
    
    // Escape to close menus
    if (e.key === 'Escape') {
        hideAppSwitcher();
        toggleQuickSettings();
        const startMenu = document.getElementById('start-menu');
        const mobileMenu = document.getElementById('mobile-menu');
        if (startMenu) startMenu.classList.remove('active');
        if (mobileMenu) mobileMenu.classList.remove('active');
    }
});

// Network Functions
function toggleNetworkSetting(key, el) {
    el.classList.toggle('active');
    const isActive = el.classList.contains('active');
    showNotification('Network', `${key} ${isActive ? 'enabled' : 'disabled'}`);
    const networkSettings = JSON.parse(localStorage.getItem('network-settings') || '{}');
    networkSettings[key] = isActive;
    localStorage.setItem('network-settings', JSON.stringify(networkSettings));
}

async function getIPAddress() {
    const ipSpan = document.getElementById('ip-address');
    if (ipSpan) {
        ipSpan.textContent = 'Loading...';
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            ipSpan.textContent = data.ip;
        } catch (error) {
            ipSpan.textContent = 'Unable to fetch';
        }
    }
}

async function testNetwork() {
    const testSpan = document.getElementById('network-test');
    if (testSpan) {
        testSpan.textContent = 'Testing...';
        const startTime = Date.now();
        try {
            const response = await fetch('https://www.google.com/favicon.ico', { mode: 'no-cors' });
            const endTime = Date.now();
            const latency = endTime - startTime;
            testSpan.textContent = `Connected (${latency}ms)`;
            testSpan.style.color = 'var(--os-success)';
        } catch (error) {
            testSpan.textContent = 'Connection failed';
            testSpan.style.color = 'var(--os-error)';
        }
    }
}

// App Store
const appStoreApps = [
    { id: 'file-manager', name: 'File Manager', icon: 'fa-folder', desc: 'Manage your files and folders', installed: true },
    { id: 'terminal', name: 'Terminal', icon: 'fa-terminal', desc: 'Command line interface', installed: true },
    { id: 'browser', name: 'Browser', icon: 'fa-globe', desc: 'Web browser', installed: true },
    { id: 'settings', name: 'Settings', icon: 'fa-cog', desc: 'System settings', installed: true },
    { id: 'calculator', name: 'Calculator', icon: 'fa-calculator', desc: 'Scientific calculator', installed: true },
    { id: 'editor', name: 'Text Editor', icon: 'fa-file-alt', desc: 'Code and text editor', installed: true },
    { id: 'music-player', name: 'Music Player', icon: 'fa-music', desc: 'Play your favorite music', installed: false },
    { id: 'image-viewer', name: 'Image Viewer', icon: 'fa-image', desc: 'View and edit images', installed: false },
    { id: 'video-player', name: 'Video Player', icon: 'fa-video', desc: 'Watch videos', installed: false },
    { id: 'notes', name: 'Notes', icon: 'fa-sticky-note', desc: 'Take quick notes', installed: false },
    { id: 'calendar', name: 'Calendar', icon: 'fa-calendar', desc: 'Manage your schedule', installed: false },
    { id: 'contacts', name: 'Contacts', icon: 'fa-address-book', desc: 'Contact manager', installed: false }
];

function loadAppStore() {
    const grid = document.getElementById('app-store-grid');
    if (!grid) return;
    
    grid.innerHTML = '';
    appStoreApps.forEach(app => {
        const item = document.createElement('div');
        item.className = 'app-store-item';
        item.innerHTML = `
            <i class="fas ${app.icon}"></i>
            <h3>${app.name}</h3>
            <p>${app.desc}</p>
            <button class="${app.installed ? 'installed' : ''}" onclick="installApp('${app.id}', this)">
                ${app.installed ? '<i class="fas fa-check"></i> Installed' : '<i class="fas fa-download"></i> Install'}
            </button>
        `;
        grid.appendChild(item);
    });
    
    // Search functionality
    const searchInput = document.getElementById('app-store-search');
    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const items = grid.querySelectorAll('.app-store-item');
            items.forEach(item => {
                const name = item.querySelector('h3').textContent.toLowerCase();
                const desc = item.querySelector('p').textContent.toLowerCase();
                if (name.includes(query) || desc.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    }
}

function installApp(appId, button) {
    const app = appStoreApps.find(a => a.id === appId);
    if (!app) return;
    
    if (app.installed) {
        showNotification('App Store', `${app.name} is already installed`);
        return;
    }
    
    // Simulate installation
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Installing...';
    
    setTimeout(() => {
        app.installed = true;
        button.classList.add('installed');
        button.innerHTML = '<i class="fas fa-check"></i> Installed';
        button.disabled = false;
        showNotification('App Store', `${app.name} installed successfully!`);
    }, 2000);
}

// Initialize on load
window.addEventListener('load', () => {
    localStorage.setItem('os-start-time', Date.now());
    hideBootScreen();
    
    // Load quick settings
    const quickSettings = JSON.parse(localStorage.getItem('quick-settings') || '{}');
    Object.keys(quickSettings).forEach(key => {
        const el = document.querySelector(`[onclick*="${key}"]`);
        if (el && quickSettings[key]) {
            el.classList.add('active');
        }
    });
    
    // Load app store when opened
    setTimeout(() => {
        const appStore = document.getElementById('window-app-store');
        if (appStore) {
            const observer = new MutationObserver(() => {
                if (appStore.classList.contains('active')) {
                    loadAppStore();
                }
            });
            observer.observe(appStore, { attributes: true, attributeFilter: ['class'] });
        }
    }, 1000);
});

// Click on desktop to focus
document.getElementById('desktop').addEventListener('click', (e) => {
    if (e.target.id === 'desktop' || e.target.closest('.desktop-icons')) {
        // Deselect all windows
        document.querySelectorAll('.window').forEach(w => {
            w.classList.remove('active');
        });
        osState.activeWindow = null;
    }
});
</script>
</body>
</html>image.png